generator client {
  provider = "prisma-client"
  output   = "./generated"
  engineType = "client"
  runtime = "bun"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String   @id @default(uuid())
  email             String   @unique
  password          String
  name              String?
  role              String   @default("USER") // USER, ADMIN
  isVerified        Boolean  @default(false)
  verificationToken String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model UserPreferences {
  id                      String   @id @default(uuid())
  userId                  String   @unique
  
  // Global notification toggles
  notificationsEnabled    Boolean  @default(true)
  emailNotifications      Boolean  @default(true)
  pushNotifications       Boolean  @default(true)
  
  // Granular notification type preferences
  kaizenReminders         Boolean  @default(true)  // Due flashcard reminders
  doomscrollAlerts        Boolean  @default(true)  // Doomscroll interventions
  memoryOfDay             Boolean  @default(true)  // Daily memory insights
  friendChallenges        Boolean  @default(true)  // Friend activity updates
  weeklyInsights          Boolean  @default(true)  // Weekly summary emails
  
  // Other preferences
  focusModeDefault        String?  // Default focus mode ID
  theme                   String   @default("LIGHT") // LIGHT, DARK, AUTO
  language                String   @default("en")
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt
}

model UserGoal {
  id              String   @id @default(uuid())
  userId          String
  title           String
  description     String?
  targetValue     Int      // e.g., 30 minutes daily focus time
  currentValue    Int      @default(0)
  unit            String   // MINUTES, HOURS, SESSIONS, CAPTURES
  category        String   // FOCUS, LEARNING, PRODUCTIVITY, WELLNESS
  deadline        DateTime?
  isCompleted     Boolean  @default(false)
  completedAt     DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([userId])
}

model FocusMode {
  id                String   @id @default(uuid())
  userId            String
  name              String   // e.g., "Deep Work", "Study Time"
  description       String?
  duration          Int      // Duration in minutes
  blockedApps       String   // JSON array of app identifiers
  allowedApps       String   // JSON array of app identifiers
  isActive          Boolean  @default(false)
  startedAt         DateTime?
  endedAt           DateTime?
  totalSessions     Int      @default(0)
  totalMinutes      Int      @default(0)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([userId])
  @@index([createdAt])
}

model Friendship {
  id          String   @id @default(uuid())
  userId      String   // User who sent request
  friendId    String   // User who received request
  status      String   @default("PENDING") // PENDING, ACCEPTED, REJECTED, BLOCKED
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([userId, friendId])
  @@index([userId])
  @@index([friendId])
  @@index([status])
}

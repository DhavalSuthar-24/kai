generator client {
  provider = "prisma-client"
  output   = "./generated"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String   @id @default(uuid())
  email             String   @unique
  password          String
  name              String?
  role              String   @default("USER") // USER, ADMIN
  isVerified        Boolean  @default(false)
  verificationToken String?
  verificationTokenExpiry DateTime?
  resetToken        String?
  resetTokenExpiry  DateTime?
  provider          String?  // google, github, etc.
  providerId        String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  deletedAt         DateTime?
  archivedAt        DateTime?
  publicKey         String?  // For E2EE data export

  refreshTokens     RefreshToken[]
  preferences       UserPreferences?

  @@index([email])
  @@index([provider, providerId])
}

model RefreshToken {
  id         String    @id @default(uuid())
  userId     String
  token      String    @unique // Hashed SHA256
  expiresAt  DateTime
  createdAt  DateTime  @default(now())
  isRevoked  Boolean   @default(false)
  revokedAt  DateTime?

  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
}

model UserPreferences {
  id                      String   @id @default(uuid())
  userId                  String   @unique
  
  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Global notification toggles - MOVED TO notification-service
  // Granular notification type preferences - MOVED TO notification-service
  
  // Other preferences
  focusModeDefault        String?  // Default focus mode ID
  theme                   String   @default("LIGHT") // LIGHT, DARK, AUTO
  language                String   @default("en")
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt
}



